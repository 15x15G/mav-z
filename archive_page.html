<!DOCTYPE html>
<html>

<head>
    <title>Mastodon Archive</title>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <link rel="stylesheet" type="text/css" href="./assets/style.css" />
    <link rel="icon" href="./assets/favicon.ico" type="image/x-icon" />

    <template id="article">
        <article class='status'>
            <div class='status__box'>
                <div class='status__date'><span ></span></div>
                <div class='status__content'></div>
                <div class='status__media'></div>
            </div>
        </article>
    </template>
    <template id="article--CW">
        <article class='status'>
            <div class='status__box'>
                <div class='status__date'><span></span></div>
                <details>
                    <summary class='status__summary'></summary>
                    <div class='status__content'></div>
                    <div class='status__media'></div>
                </details>
            </div>
        </article>
    </template>
    <template id="media-video">
        <video controls muted src='' class='status__media'>
            There should be a video here.
        </video>
    </template>
    <template id="media-image">
        <img class='status__media image' src='' onclick = ''>
    </template>
</head>

<body>
    <button onclick="topFunction()" id="scroll_top_button" title="Go to top">⇧</button>
    <div class="container">
        嘟嘟概览：
            <ul>
                <li><p>按顺序加载完 actor.json 和 outbox.json 后这个表格会自动生成统计数据.</p></li>
                <li><p>自己回复自己的嘟文算做是原创，显示在“嘟文”那一列里. 这与网页版 Mastodon 是一致的.</p></li>
                <li><p>一条回复的原嘟文如果被删除（或原嘟主注销帐号导致的其所有嘟文被删除），则这条嘟文会由回复变为原创，显示在“嘟文”那一列里. 同时，统计表格中原创的嘟文数量可能会有所增加，而回复的嘟文数量会相应地有所减少.</p></li>
                <li><p>注意：上一条与网页版 Mastodon 并不一致，如果原嘟文被删除，则其回复在网页版的 Mastodon 里并不会显示在个人主页中的“嘟文”那一列里.</p></li>
                <li><p>如果实例没有魔改的话，申请存档中的时间都是格林威治时间，本页面上显示的时间没有做任何处理，加上 8 小时后才得到北京时间.</p></li>
                <li><p>表格最下面一行的“存档中显示的嘟文与回复数”指的是在网页版 Mastodon 的个人主页那里，关注数与关注者数左边的那个数字. 它包括转嘟，但不包括私信. 这个数字可能会大于倒数第四行的“以上两项总计”，初步判断是实例的计数有 bug：删除一条嘟文后，其他实例 api/v1/accounts/id 中的 statuses_count 有所减少，但有时候自己实例 api/v1/accounts/id 中的 statuses_count 没有变化. 我觉得非常奇怪，请各位象友指点.</p></li>
                <li><p>私信的数量默认隐藏，点击方块的位置可以显示数字，再次点击数字则隐藏.</p></li>
            </ul>
        <section id="loading">
            <div id="div-import-prompt">
                <p>
                    Select <b>actor.json</b> and <b>outbox.json</b> in the archive folder.
                </p>
                <div>
                    <label id="actor-input">
                        actor.json
                        <input accept="application/json" id="actor-file-input" type="file" style="display:none">
                    </label>
                    <label id="outbox-input">
                        outbox.json
                        <input accept="application/json" id="outbox-file-input" type="file" style="display:none">
                    </label>
                    <label>
                        From
                        <input id="date-input-from" type="date" onchange="save_date_from(event);"/>
                        To
                        <input id="date-input-to" type="date" onchange="save_date_to(event);"/>
                    </label>
                </div>
            </div>
        </section>
        <section id="overviews">
            <!-- I just put the styles of this table here so that it can be modified easily. -->
            <!-- Really thankful to the excellent tool: https://www.tablesgenerator.com/html_tables# -->
            <style type="text/css">
                .tg  {border-collapse:collapse;border-spacing:0;}
                .tg td{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;
                    overflow:hidden;padding:10px 5px;word-break:normal;}
                .tg th{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;
                    font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}
                .tg .tg-nrix{border-color:#fff1e8;text-align:center;vertical-align:middle}
            </style>
            <table class="tg" style="undefined;table-layout: fixed; width: 469px">
                <colgroup>
                    <col style="width: 101px">
                    <col style="width: 81px">
                    <col style="width: 81px">
                    <col style="width: 81px">
                    <col style="width: 3px">
                    <col style="width: 301px">
                    <col style="width: 301px">
                </colgroup>
                <tbody>
                    <tr>
                        <td class="tg-nrix"><b><span style="color:lightgreen">发嘟</span></b>概览</td>
                        <td class="tg-nrix">原创</td>
                        <td class="tg-nrix">回复</td>
                        <td class="tg-nrix">总计</td>
                        <td class="tg-nrix" rowspan="9"></td>
                        <td class="tg-nrix">不含私信总计</td>
                        <td class="tg-nrix"><b><span style="color:red">转嘟</span></b>总计</td>
                    </tr>
                    <tr>
                        <td class="tg-nrix">公开</td>
                        <td class="tg-nrix"><b><span id="overviews_public_original" style="color:yellow"></span></b></td>
                        <td class="tg-nrix"><b><span id="overviews_public_reply" style="color:lightblue"></span></b></td>
                        <td class="tg-nrix"><span id="overviews_public"></span></td>
                        <td class="tg-nrix" rowspan="3"><span id="overviews_total_without_direct"></span>
                            <br /><br />平均 <span id="overviews_total_without_direct_a"></span> / 天
                        </td>
                        <td class="tg-nrix" rowspan="3"><b><span id="overviews_boost" style="color:red"></span></b>
                            <br /><br />平均 <span id="overviews_boost_a"></span> / 天
                        </td>
                    </tr>
                    <tr>
                        <td class="tg-nrix">不公开</td>
                        <td class="tg-nrix"><b><span id="overviews_unlisted_original" style="color:yellow"></span></b></td>
                        <td class="tg-nrix"><b><span id="overviews_unlisted_reply" style="color:lightblue"></span></b></td>
                        <td class="tg-nrix"><span id="overviews_unlisted"></span></td>
                    </tr>
                    <tr>
                        <td class="tg-nrix">仅关注者</td>
                        <td class="tg-nrix"><b><span id="overviews_followers-only_original" style="color:yellow"></span></b></td>
                        <td class="tg-nrix"><b><span id="overviews_followers-only_reply" style="color:lightblue"></span></b></td>
                        <td class="tg-nrix"><span id="overviews_followers-only"></span></td>
                    </tr>
                    <tr>
                        <td class="tg-nrix">私信</td>
                        <td class="tg-nrix"><span id="overviews_direct_original" style="color:#fff1e8;background-color:#fff1e8" class="secret" onclick="toggle_show()"></span></td>
                        <td class="tg-nrix"><span id="overviews_direct_reply" style="color:#fff1e8;background-color:#fff1e8" class="secret" onclick="toggle_show()"></span></td>
                        <td class="tg-nrix"><span id="overviews_direct" style="color:#fff1e8;background-color:#fff1e8" class="secret" onclick="toggle_show()"></span></td>
                        <td class="tg-nrix" colspan="2" rowspan="2">以上两项总计（不含私信的发嘟和转嘟）：<span id="overviews_without_reply_and_boost"></span></td>
                    </tr>
                    <tr>
                        <td class="tg-nrix">总计</td>
                        <td class="tg-nrix"><span id="overviews_original" style="color:#fff1e8;background-color:#fff1e8" class="secret" onclick="toggle_show()"></span></td>
                        <td class="tg-nrix"><span id="overviews_reply" style="color:#fff1e8;background-color:#fff1e8" class="secret" onclick="toggle_show()"></span></td>
                        <td class="tg-nrix"><b><span id="overviews_total" style="color:lightgreen;background-color:lightgreen" class="secret" onclick="toggle_show()"></span></b></td>
                    </tr>
                    <tr>
                        <td class="tg-nrix" colspan="4">上面数据的日期范围（根据在本页最上方的选择）</td>
                        <td class="tg-nrix" colspan="2"><span id="date_input_from"></span> 至 <span id="date_input_to"></span>
                            （共 <span id="date_input_diff"></span> 天）</td>
                    </tr>
                    <tr>
                        <td class="tg-nrix" colspan="4">存档中所有嘟文的日期范围（根据请求存档的时刻）</td>
                        <td class="tg-nrix" colspan="2"><span id="date_from"></span> 至 <span id="date_to"></span>
                            （共 <span id="date_diff"></span> 天）</td>
                    </tr>
                    <tr>
                        <td class="tg-nrix" colspan="4">存档中显示的嘟文与回复数</td>
                        <td class="tg-nrix" colspan="2"><span id="overviews_display"></span></td>
                    </tr>
                </tbody>
            </table>
            <div>
                <canvas id="tootChart"></canvas>
            </div>

        </section>
    </div>
    <div class="container">
        <section id="header">
            <div class="public-account-header">
                <div class="public-account-header__image" id="public-account-header__image">
                </div>
                <div class="public-account-header__bar" id="public-account-header__bar">
                </div>
                <div class="account__header__tabs__name" id="account__header__tabs__name">
                </div>
                <div class="account__header__extra">
                    <div class="account__header__bio">
                        <div class="account__header__fields" id="account__header__fields">
                        </div>
                        <div class="account__header__content" id="account__header__content">
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section class="grid" id="grid_section">
            <div class="column-0">
                <div class="account__section-headline" id="account__section-headline">
                </div>
                <main id="articles">
                </main>
            </div>
            <div class="column-1">
                <div class="archive__section" id="archive__section">
                </div>
            </div>
        </section>
    </div>
    </div>

    <!-- The Modal -->
    <div id="myModal" class="modal">
	    <!-- The Close Button -->
	    <span id="close" class="close" onclick = "clickcloseimg()">&times;</span>
	    <!-- Modal Content (The Image) -->
	    <img class="modal-content" id="img01">
	    <!-- Modal Caption (Image Text) -->
	    <div id="caption"></div>
	</div>

    <script type="text/javascript" src="./assets/chart.js"></script>
    <script type="text/javascript" src="./assets/main.js"></script>
</body>

</html>
